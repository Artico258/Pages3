@page "{filtro?}"
@model IndexModel
@{
    ViewData["Title"] = "Tareas Asignadas";
}

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">Gestión de Tareas</a>

        <div class="ms-auto d-flex align-items-center gap-3">
            <!-- FILTROS -->
            <div class="d-flex align-items-center gap-2">
                <span class="fw-semibold">Filtrar por:</span>
                <div class="btn-group" role="group">
                    <a class="btn btn-outline-primary @(Model.Filtro=="Todos" ? "active" : "")"
                       asp-page="./Index" asp-route-filtro="Todos">Todos</a>
                    <a class="btn btn-outline-warning @(Model.Filtro=="Pendiente" ? "active" : "")"
                       asp-page="./Index" asp-route-filtro="Pendiente">Pendientes</a>
                    <a class="btn btn-outline-info @(Model.Filtro=="En curso" ? "active" : "")"
                       asp-page="./Index" asp-route-filtro="En curso">En curso</a>
                    <a class="btn btn-outline-success @(Model.Filtro=="Finalizado" ? "active" : "")"
                       asp-page="./Index" asp-route-filtro="Finalizado">Finalizadas</a>
                    <a class="btn btn-outline-danger @(Model.Filtro=="Cancelado" ? "active" : "")"
                       asp-page="./Index" asp-route-filtro="Cancelado">Canceladas</a>
                </div>
            </div>

            <!-- BOTÓN CREAR TAREA -->
            <button class="btn btn-success fw-bold" id="crearTareaBtn">
                <i class="bi bi-plus-circle"></i> Crear Tarea
            </button>
        </div>
    </div>
</nav>

<!-- FORMULARIO ESCONDIDO -->
<div id="formularioCrear" class="card shadow p-4 mx-auto" style="max-width: 400px; display: none;">
    <h6 class="fw-bold mb-3">Nueva Tarea</h6>
    <form method="post" asp-page-handler="Crear">
        <div class="mb-2">
            <label for="nombreTarea" class="form-label fw-semibold">Nombre</label>
            <input type="text" class="form-control form-control-sm" id="nombreTarea" name="nombreTarea" required>
        </div>
        <div class="mb-2">
            <label for="fechaVencimiento" class="form-label fw-semibold">Vencimiento</label>
            <input type="date" class="form-control form-control-sm" id="fechaVencimiento" name="fechaVencimiento" required>
        </div>
        <div class="mb-2">
            <label for="estado" class="form-label fw-semibold">Estado</label>
            <select class="form-select form-select-sm" id="estado" name="estado" required>
                <option value="Pendiente">Pendiente</option>
                <option value="En curso">En curso</option>
                <option value="Finalizado">Finalizado</option>
                <option value="Cancelado">Cancelado</option>
            </select>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-2">
            <button type="button" class="btn btn-sm btn-secondary" id="cancelarBtn">Cancelar</button>
            <button type="submit" class="btn btn-sm btn-success">Guardar</button>
        </div>
    </form>
</div>

<!-- TABLA DE TAREAS -->
<div class="text-center">
    <div class="grid-container">
        <div class="grid-item"><b>Nombre Tarea</b></div>
        <div class="grid-item"><b>Fecha Vencimiento</b></div>
        <div class="grid-item"><b>Estado</b></div>
        <div class="grid-item"><b>Acciones</b></div>

        @foreach (var tarea in Model.Tareas.Where(t => Model.Filtro == "Todos" || t.estado == Model.Filtro))
        {
            <div class="grid-item">@tarea.nombreTarea</div>
            <div class="grid-item">
                @{
                    DateTime fecha;
                    if (DateTime.TryParse(tarea.fechaVencimiento, out fecha))
                    {
                        @fecha.ToString("dd/MM/yyyy")
                    }
                    else
                    {
                        @tarea.fechaVencimiento <!-- por si no se puede convertir -->
                    }
                }
            </div>

            <div class="grid-item">
                <span class="badge @(tarea.estado switch {
                            "Pendiente" => "bg-warning text-dark",
                            "En curso" => "bg-info",
                            "Finalizado" => "bg-success",
                            "Cancelado" => "bg-danger",
                            _ => "bg-secondary"
                        })">
                    @tarea.estado
                </span>
            </div>
            <div class="grid-item">Acciones</div>
        }

        <!-- PAGINACIÓN -->
        <nav>
            <ul class="pagination justify-content-center mt-3">
                @for (int i = 1; i <= Model.TotalPaginas; i++)
                {
                    <li class="page-item @(i == Model.PaginaActual ? "active" : "")">
                        <a class="page-link" asp-page="./Index" asp-route-pagina="@i" asp-route-filtro="@Model.Filtro">@i</a>
                    </li>
                }
            </ul>
        </nav>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById("crearTareaBtn").addEventListener("click", function () {
            document.getElementById("formularioCrear").style.display = "block";
        });

        document.getElementById("cancelarBtn").addEventListener("click", function () {
            document.getElementById("formularioCrear").style.display = "none";
        });
    </script>
} 